<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixelUp SuperApp</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#0e1013; color:#fff; }
    .topbar { background:#111; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    .topbar h1 { color:#00bfff; margin:0; }
    .nav button { margin-left:10px; background:#00bfff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; }
    .nav button:hover { background:#008ecc; }
    .container { padding:20px; }
    .box { background:#1b1e24; border-radius:8px; padding:20px; margin-bottom:20px; }
    textarea,input { width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none; }
    button { background:#00bfff; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; margin-top:10px; }
    button:hover { background:#008ecc; }
    .chat { background:#000; padding:10px; height:300px; overflow-y:auto; border-radius:6px; margin-bottom:10px; }
    .user { color:#00ffff; }
    .bot { color:#7fff7f; }
    img { max-width:250px; margin-top:10px; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>PixelUp SuperApp</h1>
    <div class="nav">
      <button onclick="showView('crm')">CRM</button>
      <button onclick="showView('mentoria')">Mentoria</button>
      <button onclick="showView('chatbot')">ChatBot</button>
      <button onclick="showView('whatsapp')">WhatsApp</button>
    </div>
  </div>

  <div class="container">
    <div id="view-crm" class="box" style="display:none;">
      <h2>CRM</h2>
      <p>Aqui entra o formulário e lista de contatos do CRM.</p>
    </div>

    <div id="view-mentoria" class="box" style="display:none;">
      <h2>Mentoria</h2>
      <p>Aqui entram os módulos da mentoria.</p>
    </div>

    <div id="view-chatbot" class="box" style="display:none;">
      <h2>ChatBot (Gemini)</h2>
      <div class="chat" id="chatlog"></div>
      <input id="userInput" placeholder="Digite sua mensagem...">
      <button onclick="sendMessage()">Enviar</button>
    </div>

    <div id="view-whatsapp" class="box" style="display:none;">
      <h2>Conexão WhatsApp</h2>
      <p>Status: <span id="waStatus">Desconectado</span></p>
      <button onclick="startWA()">Conectar / Mostrar QR</button>
      <button onclick="checkWA()">Atualizar status</button>
      <div id="waQR"></div>
    </div>
  </div>

<script>
/* ===== CONFIG ===== */
const WA_API = "https://pixelup-wa-server.pixelupmrkt.repl.co"; // seu servidor Replit
const GEMINI_API = "/api/chat"; // Chat API do Vercel

/* ===== Navegação ===== */
function showView(id){
  document.querySelectorAll(".box").forEach(el=>el.style.display="none");
  document.getElementById("view-"+id).style.display="block";
}
showView("crm");

/* ===== ChatBot (Gemini) ===== */
async function sendMessage(){
  const input = document.getElementById("userInput");
  const msg = input.value.trim();
  if(!msg) return;
  const log = document.getElementById("chatlog");
  log.innerHTML += `<div class="user">USER: ${msg}</div>`;
  input.value="";

  try {
    const res = await fetch(GEMINI_API, {
      method:"POST", headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    log.innerHTML += `<div class="bot">BOT: ${data.reply}</div>`;
    log.scrollTop = log.scrollHeight;
  } catch(e){
    log.innerHTML += `<div class="bot">BOT Erro: ${e}</div>`;
  }
}

/* ===== WhatsApp ===== */
async function startWA(){
  const waStatus = document.getElementById("waStatus");
  const waQR = document.getElementById("waQR");
  try {
    const res = await fetch(WA_API+"/api/wa/start",{method:"POST"});
    const data = await res.json();
    if(data.qr){
      waQR.innerHTML = `<img src="${data.qr}" alt="QR Code">`;
      waStatus.textContent = "Aguardando conexão...";
    } else {
      waQR.innerHTML = "";
      waStatus.textContent = data.connected ? "Conectado ✅" : "Desconectado";
    }
  } catch(e){
    waStatus.textContent = "Erro ao iniciar sessão";
    console.error("startWA error:", e);
  }
}

async function checkWA(){
  const waStatus = document.getElementById("waStatus");
  const waQR = document.getElementById("waQR");
  try {
    const res = await fetch(WA_API+"/api/wa/status");
    const data = await res.json();
    waStatus.textContent = data.connected ? "Conectado ✅" : "Desconectado";
    if(data.qr){
      waQR.innerHTML = `<img src="${data.qr}" alt="QR Code">`;
    }
  } catch(e){
    waStatus.textContent = "Erro ao verificar";
  }
}
</script>
</body>
</html><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixelUp SuperApp</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#0e1013; color:#fff; }
    .topbar { background:#111; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    .topbar h1 { color:#00bfff; margin:0; }
    .nav button { margin-left:10px; background:#00bfff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; }
    .nav button:hover { background:#008ecc; }
    .container { padding:20px; max-width:1000px; margin:auto; }
    .box { background:#1b1e24; border-radius:8px; padding:20px; margin-bottom:20px; }
    textarea,input { width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none; }
    button { background:#00bfff; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; margin-top:10px; }
    button:hover { background:#008ecc; }
    .chat { background:#000; padding:10px; height:300px; overflow-y:auto; border-radius:6px; margin-bottom:10px; }
    .user { color:#00ffff; }
    .bot { color:#7fff7f; }
    img { max-width:260px; margin-top:10px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>PixelUp SuperApp</h1>
    <div class="nav">
      <button onclick="showView('crm')">CRM</button>
      <button onclick="showView('mentoria')">Mentoria</button>
      <button onclick="showView('chatbot')">ChatBot</button>
      <button onclick="showView('whatsapp')">WhatsApp</button>
    </div>
  </div>

  <div class="container">
    <div id="view-crm" class="box" style="display:none;">
      <h2>CRM</h2>
      <p>Formulário e lista do CRM (sua parte). Se quiser, te mando a versão com Kanban e envio via WhatsApp.</p>
    </div>

    <div id="view-mentoria" class="box" style="display:none;">
      <h2>Mentoria</h2>
      <p>Coloque seus módulos fixos aqui.</p>
    </div>

    <div id="view-chatbot" class="box" style="display:none;">
      <h2>ChatBot (Gemini)</h2>
      <div class="chat" id="chatlog"></div>
      <input id="userInput" placeholder="Digite sua mensagem...">
      <button onclick="sendMessage()">Enviar</button>
    </div>

    <div id="view-whatsapp" class="box" style="display:none;">
      <h2>Conexão WhatsApp</h2>
      <p>Status: <span id="waStatus">Desconectado</span></p>
      <button onclick="startWA()">Conectar / Mostrar QR</button>
      <button onclick="checkWA()">Atualizar status</button>
      <div id="waQR"></div>
    </div>
  </div>

<script>
/* ===== CONFIG ===== */
// Agora o front chama o proxy do Vercel (mesma origem, sem CORS)
const WA_API     = "/api/wa";
const GEMINI_API = "/api/chat"; // seu endpoint no Vercel

/* ===== Navegação ===== */
function showView(id){
  document.querySelectorAll(".box").forEach(el=>el.style.display="none");
  document.getElementById("view-"+id).style.display="block";
}
showView("whatsapp"); // abrir direto na aba do WA para testar

/* ===== ChatBot (Gemini) ===== */
async function sendMessage(){
  const input = document.getElementById("userInput");
  const msg = input.value.trim();
  if(!msg) return;
  const log = document.getElementById("chatlog");
  log.innerHTML += `<div class="user">USER: ${msg}</div>`;
  input.value="";

  try {
    const res  = await fetch(GEMINI_API, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    log.innerHTML += `<div class="bot">BOT: ${data.reply}</div>`;
    log.scrollTop = log.scrollHeight;
  } catch(e){
    log.innerHTML += `<div class="bot">BOT Erro: ${e}</div>`;
  }
}

/* ===== WhatsApp ===== */
async function startWA(){
  const waStatus = document.getElementById("waStatus");
  const waQR = document.getElementById("waQR");
  try {
    const res = await fetch(WA_API + "/start", { method:"POST", headers:{ "Content-Type":"application/json" }, body:"{}" });
    const data = await res.json();
    if(data.qr){
      waQR.innerHTML = `<img src="${data.qr}" alt="QR Code">`;
      waStatus.textContent = "Aguardando conexão...";
    } else {
      waQR.innerHTML = "";
      waStatus.textContent = data.connected ? "Conectado ✅" : "Desconectado";
    }
  } catch(e){
    waStatus.textContent = "Erro ao iniciar sessão";
    console.error("startWA error:", e);
  }
}

async function checkWA(){
  const waStatus = document.getElementById("waStatus");
  const waQR = document.getElementById("waQR");
  try {
    const res  = await fetch(WA_API + "/status");
    const data = await res.json();
    waStatus.textContent = data.connected ? "Conectado ✅" : "Desconectado";
    if(data.qr){
      waQR.innerHTML = `<img src="${data.qr}" alt="QR Code">`;
    }
  } catch(e){
    waStatus.textContent = "Erro ao verificar";
  }
}
</script>
</body>
</html>

