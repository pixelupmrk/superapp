<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CRM PixelUp + WhatsApp + Planilhas</title>
<meta name="color-scheme" content="dark">
<style>
/* (estilos iguais ao seu código anterior) */
:root{--bg:#0b1016;--panel:#0f1722;--muted:#9fb1c4;--text:#eaf6ff;--brand:#00b3ff;--line:#12334c;--ok:#16a34a;--warn:#f59e0b}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:
linear-gradient(180deg,rgba(2,8,18,.92),rgba(2,8,18,.92)),
radial-gradient(900px 520px at 90% -10%, rgba(0,179,255,.18), transparent 60%),
radial-gradient(800px 500px at -10% 120%, rgba(0,179,255,.12), transparent 60%), #0e1013;color:var(--text)}
.topbar{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;padding:12px 16px;background:rgba(9,16,24,.8);backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid var(--line)}
.brand{display:flex;align-items:center;gap:10px;font-weight:800}
.dot{width:12px;height:12px;border-radius:50%;background:linear-gradient(180deg,var(--brand),#39dbff)}
nav{margin-left:auto;display:flex;gap:6px}
nav a{padding:8px 10px;border-radius:10px;text-decoration:none;color:#d7eeff;border:1px solid transparent}
nav a.active,nav a:hover{border-color:#174464;background:rgba(0,179,255,.08)}
.container{max-width:1100px;margin:22px auto;padding:0 14px}
.page{display:none}.page.active{display:block}
.card{background:linear-gradient(180deg,rgba(14,22,33,.9),rgba(9,15,24,.9));border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 40px rgba(0,179,255,.06)}
h1{font-size:22px;margin:6px 0 12px} h2{font-size:18px;margin:12px 0 8px}
.muted{color:var(--muted)} .small{font-size:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.grid{display:grid;gap:16px}.grid-2{grid-template-columns:1.1fr .9fr}@media (max-width:900px){.grid-2{grid-template-columns:1fr}}
input,textarea{width:100%;padding:10px 12px;border-radius:10px;background:#0b1520;border:1px solid #183149;color:#dff1ff;outline:none}
.btn{appearance:none;border:none;cursor:pointer;padding:10px 14px;border-radius:12px;color:#05121b;font-weight:800;background:linear-gradient(180deg,#79d2ff,#27b0ff);box-shadow:0 4px 18px rgba(0,179,255,.3)}
.btn.secondary{color:#dbeafe;background:transparent;border:1px solid #1b4663}
.badge{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid #123249;background:#09151f;color:#cfeaff;font-size:12px;font-weight:700}
.b-ok{border-color:#134e27;color:#b7ffd3;background:#0a1a12}
.b-warn{border-color:#614214;color:#ffe9bd;background:#1b1407}
.table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px solid #102437;padding:10px 8px;text-align:left}
.kb{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.kb-col{border:1px solid #13304a;border-radius:12px;padding:10px;background:#0b1622}
.kb-card{border:1px solid #143149;border-radius:10px;padding:10px;background:#0a1824;margin-bottom:8px}
.qrbox{display:grid;place-items:center;min-height:280px;border:1px dashed #1f415c;border-radius:16px;background:#08121a;overflow:hidden}
.qrimg{max-width:100%;image-rendering:pixelated}
.code{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:#bcd7f0}
.log{max-height:170px;overflow:auto;background:#08131b;border:1px solid #15324a;border-radius:10px;padding:8px;font-size:12px}
</style>
</head>
<body>
<header class="topbar">
  <div class="brand"><span class="dot"></span> PixelUp CRM</div>
  <nav>
    <a href="#crm" class="active">CRM</a>
    <a href="#whatsapp">WhatsApp</a>
  </nav>
</header>

<main class="container">
  <!-- CRM -->
  <section id="crm" class="page active">
    <div class="card grid grid-2">
      <section>
        <h1>Contatos</h1>
        <div class="row" id="authRow">
          <span id="authBadge" class="badge b-warn">⏺ Deslogado</span>
          <button id="btnLogout" class="btn secondary" style="display:none">Sair</button>
        </div>

        <div id="loginBox" style="margin-top:10px">
          <div class="row">
            <input id="email" type="email" placeholder="E-mail"/>
            <input id="pass" type="password" placeholder="Senha"/>
          </div>
          <div class="row">
            <button id="btnLogin" class="btn">Entrar</button>
            <button id="btnSignup" class="btn secondary">Criar conta</button>
          </div>
          <p class="small muted">Autenticação Firebase. Sem Firebase, usa <b>localStorage</b>.</p>
        </div>

        <div id="contactForm" style="display:none;margin-top:10px">
          <h2>Novo contato</h2>
          <div class="row">
            <input id="c_name" placeholder="Nome"/>
            <input id="c_phone" placeholder="Telefone (DDD)"/>
          </div>
          <div class="row"><input id="c_email" placeholder="E-mail"/></div>
          <textarea id="c_notes" rows="3" placeholder="Observações"></textarea>
          <div class="row" style="margin-top:8px">
            <button id="btnSaveContact" class="btn">Salvar contato</button>
            <span id="saveInfo" class="muted small"></span>
          </div>

          <!-- Importar/Exportar Planilha -->
          <div class="row" style="margin-top:14px">
            <input type="file" id="fileImport" accept=".csv" style="display:none"/>
            <button id="btnImport" class="btn secondary">Importar CSV</button>
            <button id="btnExport" class="btn secondary">Exportar CSV</button>
          </div>

          <h2 style="margin-top:18px">Lista</h2>
          <table class="table" id="tblContacts">
            <thead><tr><th>Nome</th><th>Telefone</th><th>E-mail</th><th>Obs.</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Kanban -->
      <aside>
        <h2>Kanban</h2>
        <div class="kb" id="kanban">
          <div class="kb-col" data-col="novo"><b>Novo</b><div class="kb-list"></div></div>
          <div class="kb-col" data-col="progresso"><b>Em Progresso</b><div class="kb-list"></div></div>
          <div class="kb-col" data-col="fechado"><b>Fechado</b><div class="kb-list"></div></div>
        </div>
        <div class="row" style="margin-top:10px">
          <input id="leadTitle" placeholder="Título do lead"/>
          <button id="btnAddLead" class="btn">Adicionar lead</button>
        </div>
      </aside>
    </div>
  </section>

  <!-- WhatsApp -->
  <section id="whatsapp" class="page">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div><h1>Conexão WhatsApp</h1></div>
        <div id="waStatus" class="badge b-warn">⏺ Desconectado</div>
      </div>
      <div class="row" style="margin:10px 0">
        <button id="waConnect" class="btn">Conectar / Mostrar QR</button>
        <button id="waStatusBtn" class="btn secondary">Atualizar status</button>
      </div>
      <div class="qrbox" id="qrBox"><div class="muted">Clique em <b>Conectar</b> e escaneie no WhatsApp.</div></div>
      <div class="log" id="waLog" style="margin-top:10px"></div>
    </div>
  </section>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<script>
// -------------------- IMPORT/EXPORT CSV --------------------
function exportCSV(data){
  const header=["Nome","Telefone","Email","Observações"];
  const rows=data.map(c=>[c.name,c.phone,c.email,c.notes]);
  const csv=[header,...rows].map(r=>r.join(";")).join("\n");
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="contatos_pixelup.csv";
  a.click();
}
function parseCSV(text){
  const lines=text.split(/\r?\n/).slice(1);
  return lines.map(l=>{
    const [name,phone,email,notes]=l.split(";");
    return {name,phone,email,notes,ts:Date.now()};
  }).filter(c=>c.name);
}
btnExport.onclick=async ()=>{
  const uid=getUID();
  if(fb.ok){
    const snap=await db.collection("users").doc(uid).collection("contacts").get();
    exportCSV(snap.docs.map(d=>d.data()));
  }else{
    const arr=JSON.parse(localStorage.getItem("px_contacts_"+uid)||"[]");
    exportCSV(arr);
  }
};
btnImport.onclick=()=> fileImport.click();
fileImport.onchange=async e=>{
  const file=e.target.files[0]; if(!file) return;
  const text=await file.text();
  const arr=parseCSV(text);
  for(const c of arr){
    if(fb.ok){ await db.collection("users").doc(getUID()).collection("contacts").add(c); }
    else{
      const key="px_contacts_"+getUID();
      const old=JSON.parse(localStorage.getItem(key)||"[]"); old.push(c);
      localStorage.setItem(key,JSON.stringify(old));
    }
  }
  loadContacts();
};
// ------------------------------------------------------------
</script>
</body>
</html>
